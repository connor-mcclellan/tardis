

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-53HJHD1BWS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-53HJHD1BWS');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tardis.spectrum.formal_integral module &mdash; tardis</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />

  
    <link rel="shortcut icon" href="../_static/tardis_logo.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.13/dist/embed-amd.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="tardis.spectrum.formal_integral_cuda module" href="tardis.spectrum.formal_integral_cuda.html" />
    <link rel="prev" title="tardis.spectrum.base module" href="tardis.spectrum.base.html" />
    <link href="../_static/tardis.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            tardis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart for TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how_to_guides.html">How-To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">API</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="tardis.html">tardis package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="tardis.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="tardis.energy_input.html">tardis.energy_input package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.grid.html">tardis.grid package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.gui.html">tardis.gui package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.io.html">tardis.io package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.model.html">tardis.model package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.opacities.html">tardis.opacities package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.plasma.html">tardis.plasma package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.scripts.html">tardis.scripts package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.simulation.html">tardis.simulation package</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="tardis.spectrum.html">tardis.spectrum package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.stats.html">tardis.stats package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.transport.html">tardis.transport package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.util.html">tardis.util package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.visualization.html">tardis.visualization package</a></li>
<li class="toctree-l4"><a class="reference internal" href="tardis.workflows.html">tardis.workflows package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tardis.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="tardis.html#module-tardis">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Input/Output</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../io/hdf/index.html">Hierarchical Data Format (HDF5)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/configuration/index.html">Configuration (Required Input)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/model/index.html">Reading Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/optional/index.html">Optional Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/output/index.html">Additional Outputs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Analyzing Tardis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../analyzing_tardis/visualization/index.html">Visualization Tools &amp; Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analyzing_tardis/spectrum/index.html">Analyzing TARDIS Spectra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analyzing_tardis/liv_plot_notebook.html">Analyzing Last Interaction Velocity (LIV) Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analyzing_tardis/rpacket_plot_notebook.html">Analysing Montecarlo Packets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analyzing_tardis/analysing_convergence_plot.html">Convergence Plots</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics Walkthrough</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../physics/intro/index.html">Physics Walkthrough Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics/setup/index.html">Setting Up the Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics/montecarlo/index.html">Monte Carlo Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics/update_and_conv/update_and_conv.html">Updating Plasma and Convergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics/spectrum/index.html">Spectrum Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics/tardisgamma/index.html">TARDIS-High Energy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to TARDIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/CONTRIBUTING.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/development/index.html">Developer Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/tools/index.html">Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/in_progress/index.html">Features In-Progress</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../resources/credits.html">Credits &amp; Publication Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/research_done_using_TARDIS/research_papers.html">Papers Using TARDIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/code_comparison/index.html">Code Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/zreferences.html">References and Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tardis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">tardis</a></li>
          <li class="breadcrumb-item"><a href="tardis.html">tardis package</a></li>
          <li class="breadcrumb-item"><a href="tardis.spectrum.html">tardis.spectrum package</a></li>
      <li class="breadcrumb-item active">tardis.spectrum.formal_integral module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/tardis.spectrum.formal_integral.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-tardis.spectrum.formal_integral">
<span id="tardis-spectrum-formal-integral-module"></span><h1>tardis.spectrum.formal_integral module<a class="headerlink" href="#module-tardis.spectrum.formal_integral" title="Link to this heading">¶</a></h1>
<dl class="py exception">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.BoundsError">
<em class="property"><span class="k"><span class="pre">exception</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">tardis.spectrum.formal_integral.</span></span><span class="sig-name descname"><span class="pre">BoundsError</span></span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#BoundsError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.BoundsError" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#IndexError" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">IndexError</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.FormalIntegrator">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">tardis.spectrum.formal_integral.</span></span><span class="sig-name descname"><span class="pre">FormalIntegrator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">simulation_state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plasma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transport</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opacity_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">macro_atom_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">points</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#FormalIntegrator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.FormalIntegrator" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Class containing the formal integrator.</p>
<p>If there is a NVIDIA CUDA GPU available,
the formal integral will automatically run
on it. If multiple GPUs are available, it will
choose the first one that it sees. You can
read more about selecting different GPUs on
Numba’s CUDA documentation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>model</strong><span class="classifier">tardis.model.SimulationState</span></dt><dd></dd>
<dt><strong>plasma</strong><span class="classifier">tardis.plasma.BasePlasma</span></dt><dd></dd>
<dt><strong>transport</strong><span class="classifier">tardis.transport.montecarlo.MontecarloTransport</span></dt><dd></dd>
<dt><strong>points</strong><span class="classifier">int64</span></dt><dd></dd>
</dl>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.FormalIntegrator.calculate_spectrum">
<span class="sig-name descname"><span class="pre">calculate_spectrum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frequency</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">points</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interpolate_shells</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raises</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#FormalIntegrator.calculate_spectrum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.FormalIntegrator.calculate_spectrum" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.FormalIntegrator.check">
<span class="sig-name descname"><span class="pre">check</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raises</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#FormalIntegrator.check"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.FormalIntegrator.check" title="Link to this definition">¶</a></dt>
<dd><p>A method that determines if the formal integral can be performed with
the current configuration settings</p>
<p>The function returns False if the configuration conflicts with the
required settings. If raises evaluates to True, then a
IntegrationError is raised instead</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.FormalIntegrator.formal_integral">
<span class="sig-name descname"><span class="pre">formal_integral</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#FormalIntegrator.formal_integral"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.FormalIntegrator.formal_integral" title="Link to this definition">¶</a></dt>
<dd><p>Do the formal integral with the numba
routines</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.FormalIntegrator.generate_numba_objects">
<span class="sig-name descname"><span class="pre">generate_numba_objects</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#FormalIntegrator.generate_numba_objects"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.FormalIntegrator.generate_numba_objects" title="Link to this definition">¶</a></dt>
<dd><p>instantiate the numba interface objects
needed for computing the formal integral</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.FormalIntegrator.interpolate_integrator_quantities">
<span class="sig-name descname"><span class="pre">interpolate_integrator_quantities</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">att_S_ul</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Jredlu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Jbluelu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">e_dot_u</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#FormalIntegrator.interpolate_integrator_quantities"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.FormalIntegrator.interpolate_integrator_quantities" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.FormalIntegrator.make_source_function">
<span class="sig-name descname"><span class="pre">make_source_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#FormalIntegrator.make_source_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.FormalIntegrator.make_source_function" title="Link to this definition">¶</a></dt>
<dd><p>Calculates the source function using the line absorption rate estimator <code class="xref py py-obj docutils literal notranslate"><span class="pre">Edotlu_estimator</span></code></p>
<p>Formally it calculates the expression ( 1 - exp(-tau_ul) ) S_ul but this product is what we need later,
so there is no need to factor out the source function explicitly.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>model</strong><span class="classifier">tardis.model.SimulationState</span></dt><dd></dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>Numpy array containing ( 1 - exp(-tau_ul) ) S_ul ordered by wavelength of the transition u -&gt; l</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.IntegrationError">
<em class="property"><span class="k"><span class="pre">exception</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">tardis.spectrum.formal_integral.</span></span><span class="sig-name descname"><span class="pre">IntegrationError</span></span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#IntegrationError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.IntegrationError" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#Exception" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.NumbaFormalIntegrator">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">tardis.spectrum.formal_integral.</span></span><span class="sig-name descname"><span class="pre">NumbaFormalIntegrator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">geometry</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_explosion</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plasma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">points</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#NumbaFormalIntegrator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.NumbaFormalIntegrator" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Helper class for performing the formal integral
with numba.</p>
<dl class="py method">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.NumbaFormalIntegrator.formal_integral">
<span class="sig-name descname"><span class="pre">formal_integral</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iT</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inu_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">att_S_ul</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Jred_lu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Jblue_lu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_sobolev</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">electron_density</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#NumbaFormalIntegrator.formal_integral"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.NumbaFormalIntegrator.formal_integral" title="Link to this definition">¶</a></dt>
<dd><p>Simple wrapper for the numba implementation of the formal integral</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.calculate_p_values">
<span class="sig-prename descclassname"><span class="pre">tardis.spectrum.formal_integral.</span></span><span class="sig-name descname"><span class="pre">calculate_p_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">R_max</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#calculate_p_values"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.calculate_p_values" title="Link to this definition">¶</a></dt>
<dd><p>This can probably be replaced with a simpler function</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.calculate_z">
<span class="sig-prename descclassname"><span class="pre">tardis.spectrum.formal_integral.</span></span><span class="sig-name descname"><span class="pre">calculate_z</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">r</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inv_t</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#calculate_z"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.calculate_z" title="Link to this definition">¶</a></dt>
<dd><p>Calculate distance to p line</p>
<p>Calculate half of the length of the p-line inside a shell
of radius r in terms of unit length (c * t_exp).
If shell and p-line do not intersect, return 0.</p>
<dl class="simple">
<dt>Inputs:</dt><dd><dl class="field-list simple">
<dt class="field-odd">r<span class="colon">:</span></dt>
<dd class="field-odd"><p>(double) radius of the shell</p>
</dd>
<dt class="field-even">p<span class="colon">:</span></dt>
<dd class="field-even"><p>(double) distance of the p-line to the center of the supernova</p>
</dd>
<dt class="field-odd">inv_t<span class="colon">:</span></dt>
<dd class="field-odd"><p>(double) inverse time_explosio is needed to norm to unit-length</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.intensity_black_body">
<span class="sig-prename descclassname"><span class="pre">tardis.spectrum.formal_integral.</span></span><span class="sig-name descname"><span class="pre">intensity_black_body</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">temperature</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#intensity_black_body"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.intensity_black_body" title="Link to this definition">¶</a></dt>
<dd><p>Calculate the blackbody intensity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>nu</strong><span class="classifier">float64</span></dt><dd><p>frequency</p>
</dd>
<dt><strong>temperature</strong><span class="classifier">float64</span></dt><dd><p>Temperature</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>float64</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.line_search">
<span class="sig-prename descclassname"><span class="pre">tardis.spectrum.formal_integral.</span></span><span class="sig-name descname"><span class="pre">line_search</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nu_insert</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">number_of_lines</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#line_search"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.line_search" title="Link to this definition">¶</a></dt>
<dd><p>Insert a value in to an array of line frequencies</p>
<dl class="simple">
<dt>Inputs:</dt><dd><dl class="field-list simple">
<dt class="field-odd">nu<span class="colon">:</span></dt>
<dd class="field-odd"><p>(array) line frequencies</p>
</dd>
<dt class="field-even">nu_insert<span class="colon">:</span></dt>
<dd class="field-even"><p>(int) value of nu key</p>
</dd>
<dt class="field-odd">number_of_lines<span class="colon">:</span></dt>
<dd class="field-odd"><p>(int) number of lines in the line list</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><dl class="simple">
<dt>index of the next line ot the red.</dt><dd><dl class="simple">
<dt>If the key value is redder</dt><dd><p>than the reddest line returns number_of_lines.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.numba_formal_integral">
<span class="sig-prename descclassname"><span class="pre">tardis.spectrum.formal_integral.</span></span><span class="sig-name descname"><span class="pre">numba_formal_integral</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">geometry</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_explosion</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plasma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iT</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inu_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">att_S_ul</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Jred_lu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Jblue_lu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_sobolev</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">electron_density</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#numba_formal_integral"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.numba_formal_integral" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>L</strong><span class="classifier">float64 array</span></dt><dd><p>integrated luminosities</p>
</dd>
<dt><strong>I_nu_p</strong><span class="classifier">float64 2D array</span></dt><dd><p>intensities at each p-ray multiplied by p
frequency x p-ray grid</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.populate_z">
<span class="sig-prename descclassname"><span class="pre">tardis.spectrum.formal_integral.</span></span><span class="sig-name descname"><span class="pre">populate_z</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">geometry</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_explosion</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">oz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">oshell_id</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#populate_z"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.populate_z" title="Link to this definition">¶</a></dt>
<dd><p>Calculate p line intersections</p>
<p>This function calculates the intersection points of the p-line with
each shell</p>
<dl class="simple">
<dt>Inputs:</dt><dd><dl class="field-list simple">
<dt class="field-odd">p<span class="colon">:</span></dt>
<dd class="field-odd"><p>(double) distance of the integration line to the center</p>
</dd>
<dt class="field-even">oz<span class="colon">:</span></dt>
<dd class="field-even"><p>(array of doubles) will be set with z values. the array is truncated
by the value <code class="xref py py-obj docutils literal notranslate"><span class="pre">1</span></code>.</p>
</dd>
<dt class="field-odd">oshell_id<span class="colon">:</span></dt>
<dd class="field-odd"><p>(int64) will be set with the corresponding shell_ids</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.reverse_binary_search">
<span class="sig-prename descclassname"><span class="pre">tardis.spectrum.formal_integral.</span></span><span class="sig-name descname"><span class="pre">reverse_binary_search</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_insert</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imax</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#reverse_binary_search"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.reverse_binary_search" title="Link to this definition">¶</a></dt>
<dd><p>Look for a place to insert a value in an inversely sorted float array.</p>
<dl class="simple">
<dt>Inputs:</dt><dd><dl class="field-list simple">
<dt class="field-odd">x<span class="colon">:</span></dt>
<dd class="field-odd"><p>(array) an inversely (largest to lowest) sorted float array</p>
</dd>
<dt class="field-even">x_insert<span class="colon">:</span></dt>
<dd class="field-even"><p>(value) a value to insert</p>
</dd>
<dt class="field-odd">imin<span class="colon">:</span></dt>
<dd class="field-odd"><p>(int) lower bound</p>
</dd>
<dt class="field-even">imax<span class="colon">:</span></dt>
<dd class="field-even"><p>(int) upper bound</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><p>index of the next boundary to the left</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="tardis.spectrum.formal_integral.trapezoid_integration">
<span class="sig-prename descclassname"><span class="pre">tardis.spectrum.formal_integral.</span></span><span class="sig-name descname"><span class="pre">trapezoid_integration</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/tardis/spectrum/formal_integral.html#trapezoid_integration"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#tardis.spectrum.formal_integral.trapezoid_integration" title="Link to this definition">¶</a></dt>
<dd><p>in the future, let’s just replace
this with the numpy trapz
since it is numba compatable</p>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tardis.spectrum.base.html" class="btn btn-neutral float-left" title="tardis.spectrum.base module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tardis.spectrum.formal_integral_cuda.html" class="btn btn-neutral float-right" title="tardis.spectrum.formal_integral_cuda module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2013-2025, TARDIS Collaboration.
      <span class="lastupdated">Last updated on 19 May 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>